(function(){"use strict";var t={2616:function(t,e,n){var s=n(9242),i=n(3396);function o(t,e,n,s,o,r){const a=(0,i.up)("Home");return(0,i.wg)(),(0,i.j4)(a)}const r={class:"home"};function a(t,e,n,s,o,a){const l=(0,i.up)("Player");return(0,i.wg)(),(0,i.iD)("div",r,[(0,i.Wm)(l)])}const l=(0,i._)("div",{class:"bg-image"},null,-1),u={class:"player"},c={class:"player-disk"},h={class:"player-control"},d={class:"player-progress"};function g(t,e,n,s,o,r){const a=(0,i.up)("Disk"),g=(0,i.up)("Control"),p=(0,i.up)("ProgressBar");return(0,i.wg)(),(0,i.iD)(i.HY,null,[l,(0,i._)("div",u,[(0,i._)("div",c,[(0,i.Wm)(a)]),(0,i._)("div",h,[(0,i.Wm)(g)]),(0,i._)("div",d,[(0,i.Wm)(p)])])],64)}var p=n(7139);function f(t,e,n,s,o,r){return(0,i.wg)(),(0,i.iD)("div",{class:(0,p.C_)(["disk",{diskPlaying:t.isPlaying}])},[(0,i._)("label",{for:"file",class:(0,p.C_)(["disk_cover",{busy:o.loading}]),ref:"cover",style:(0,p.j5)({transform:o.stopMatrix,backgroundImage:t.imgurl?`url(${t.imgurl})`:""})},null,6),(0,i._)("input",{id:"file",ref:"file",type:"file",accept:".mp3",multiple:"",onChange:e[0]||(e[0]=(...t)=>r.handleChange&&r.handleChange(...t))},null,544)],2)}var m=n(65);class y{constructor(){this.handlers=[]}listen(t){this.handlers.push(t)}emit(...t){this.handlers.forEach((e=>e(...t)))}}class v{constructor(){this.audioContext=new AudioContext,this.GainNode=this.audioContext.createGain(),this.GainNode.connect(this.audioContext.destination),this.playList=[],this.playIndex=0,this.emptyNode={offset:0,buffer:null},this.onPlay=new y,this.onPause=new y,this.onChange=new y,this.onReady=new y}async readAudioBuffer(t){return new Promise(((e,n)=>{const s=new FileReader;s.onload=async t=>{this.audioContext.decodeAudioData(t.target.result).then(e,n)},s.onerror=n,s.readAsArrayBuffer(t)}))}async readOnlineAudioBuffer(t){return new Promise(((e,n)=>{const s=new XMLHttpRequest;s.open("GET",t,!0),s.responseType="arraybuffer",s.onload=()=>{const t=s.response;this.audioContext.decodeAudioData(t).then(e,n)},s.onerror=n,s.send()}))}async appendFile(t){const e=new Image;e.src=n(1466),this.playList.push({offset:0,name:t.name,buffer:await this.readAudioBuffer(t),img:e.src}),this.onReady.emit(this)}async appendOnlineFile(t,e,n,s="",i=""){const o=new Image;o.src=e,this.playList.push({offset:0,name:n,author:s,album:i,img:o.src,buffer:await this.readOnlineAudioBuffer(t)}),console.log(this.playList)}play(){if(!this.playList.length||this.current.source)return;const t=this.audioContext.createBufferSource();t.buffer=this.current.buffer,t.onended=this.next.bind(this),t.connect(this.GainNode),t.start(0,this.current.offset),this.current.source=t,this.current.start=this.audioContext.currentTime,this.onPlay.emit(this)}pause(){this.playList.length&&this.current.source&&(this.current.source.stop(0),this.current.source.disconnect(0),this.current.source.onended=null,this.current.source=null,this.current.offset=this.position,this.current.start=null,this.onPause.emit(this))}stop(){this.pause(),this.current.offset=0,this.current.start=null}next(){this.isEmpty||(this.stop(),this.playIndex++,this.playIndex>=this.playList.length&&(this.playIndex=0),this.play(),this.onChange.emit(this))}prev(){this.isEmpty||(this.stop(),this.playIndex--,this.playIndex<0&&(this.playIndex=this.playList.length?this.playList.length-1:0),this.play(),this.onChange.emit(this))}get isEmpty(){return this.playList===this.emptyNode}get current(){return this.playList[this.playIndex]||this.emptyNode}get position(){return this.playList.length?this.current.offset+(null===this.current.start?0:this.audioContext.currentTime-this.current.start):0}set position(t){this.playList.length&&(this.stop(),this.current.offset=t,this.current.start=null,this.play())}get duration(){return this.current.buffer?this.current.buffer.duration:0}}const w=new v;var b={data(){return{stopMatrix:"",loading:!1}},computed:{...(0,m.rn)(["isPlaying","imgurl"])},watch:{isPlaying(t){if(t){const[,t,e]=this.stopMatrix.match(/^matrix\(([^,]+),([^,]+)/)||[0,0,0],n=Math.atan2(e,t)/(2*Math.PI)*360%360,s=[...document.styleSheets];s.forEach((t=>{const e=[...t.cssRules];e.forEach((t=>{t.type===t.KEYFRAMES_RULE&&"rotate"===t.name&&(t.cssRules[0].style.transform=`rotate(${n}deg)`,t.cssRules[1].style.transform=`rotate(${n+360}deg)`)}))}))}else this.stopMatrix=window.getComputedStyle(this.$refs.cover).transform}},methods:{...(0,m.OI)(["togglePlay","changeCover"]),async handleChange(){const t=this.$refs.file,e=t.files||[];for(let n=0;n<e.length;n++)this.loading=!0,await w.appendFile(e[n]),this.loading=!1;t.value=""}},mounted(){w.onReady.listen((()=>{this.changeCover()})),w.onChange.listen((()=>{this.changeCover()})),w.onPlay.listen((()=>{this.togglePlay(!0)})),w.onPause.listen((()=>{this.togglePlay(!1)}))}},x=n(89);const P=(0,x.Z)(b,[["render",f]]);var _=P;const C=(0,i._)("i",{class:"fa fa-question"},null,-1),k=[C],j=(0,i._)("i",{class:"fa fa-backward"},null,-1),L=[j],O=(0,i._)("span",{class:"play-btn"},null,-1),T=[O],M=(0,i._)("i",{class:"fa fa-forward"},null,-1),E=[M];function I(t,e,n,s,o,r){return(0,i.wg)(),(0,i.iD)("div",{class:(0,p.C_)(["control",{controlPlaying:t.isPlaying}])},[(0,i._)("div",{class:"control-btn control-btn-side",onClick:e[0]||(e[0]=(...e)=>t.gugugu&&t.gugugu(...e))},k),(0,i._)("div",{class:"control-btn control-btn-side",onClick:e[1]||(e[1]=(...t)=>r.handlePrev&&r.handlePrev(...t))},L),(0,i._)("div",{class:"control-btn",onClick:e[2]||(e[2]=(...t)=>r.handlePlay&&r.handlePlay(...t))},T),(0,i._)("div",{class:"control-btn control-btn-side",onClick:e[3]||(e[3]=(...t)=>r.handleNext&&r.handleNext(...t))},E),(0,i._)("div",{class:"control-btn control-btn-side control-btn-volume",onMousedown:e[4]||(e[4]=(...t)=>r.adjust&&r.adjust(...t))},[(0,i._)("div",{class:(0,p.C_)(["volume-control",{light:o.iconlight,dragging:o.dragging}])},[(0,i._)("div",{class:"volume-control-mask",style:(0,p.j5)({height:150*(1-o.vol)+"px"})},null,4),(0,i._)("i",{class:(0,p.C_)(["fa",{"fa-volume-off":0==o.vol,"fa-volume-up":0!=o.vol}]),style:{"z-index":"1"}},null,2)],2)],32)],2)}var N={data(){return{vol:5/6,dy:0,dragging:!1,iconlight:!1}},computed:{...(0,m.rn)(["isPlaying"])},methods:{randomMusic(){const t=new XMLHttpRequest;t.open("GET","https://api.i-meto.com/meting/api?server=netease&type=playlist&id=7336770281",!0),t.responseType="json",t.onload=()=>{const e=t.response;for(let t=0;t<e.length;t++){const n=e[t];setTimeout((()=>{w.appendOnlineFile(n.url,n.pic,n.title,n.author)}),2e3*t)}},t.onerror=t=>{console.log(t)},t.send()},handlePlay(){w.isEmpty||(this.isPlaying?w.pause():w.play())},handlePrev(){w.prev()},handleNext(){w.next()},adjust(t){this.dy=t.clientY-150*(1-this.vol),this.dragging=!0,document.onmousemove=this.onmousemove,document.onmouseup=()=>this.dragging=!1},onmousemove(t){if(this.dragging){var e=1-(t.clientY-this.dy)/150;e<0&&(e=0),e>1&&(e=1),this.iconlight=e<.12,this.vol=e,w.GainNode.gain.value=1.2*e}}},mounted(){this.randomMusic()}};const $=(0,x.Z)(N,[["render",I]]);var A=$;const D={class:"progress-title-container"},R={class:"progress-author"},B={class:"progress-text"};function F(t,e,n,s,o,r){return(0,i.wg)(),(0,i.iD)("div",{class:(0,p.C_)(["progress",{progressPlaying:t.isPlaying}])},[(0,i._)("div",D,[(0,i._)("h2",{class:(0,p.C_)(["progress-title",{scroll:o.ScrollTitle}])},[(0,i.Uk)((0,p.zw)(r.formatedName)+" ",1),(0,i._)("h3",R,(0,p.zw)(r.author),1)],2)]),(0,i._)("div",B,(0,p.zw)(r.formatedPosition)+" / "+(0,p.zw)(r.formatedDuration)+" "+(0,p.zw)(r.album),1),(0,i._)("div",{class:"progress-line",onMousedown:e[0]||(e[0]=(...t)=>r.adjust&&r.adjust(...t)),ref:"progress"},[(0,i._)("span",{style:(0,p.j5)({width:o.progress})},null,4)],544)],2)}function W(t){const e=~~(t/60),n=~~(t%60);return`${e<10?"0":""}${e}:${n<10?"0":""}${n}`}var G={data(){return{name:"",position:100,duration:3,progress:"",dragging:!1,dx:0,offsetx:0,ScrollTitle:!1}},computed:{...(0,m.rn)(["isPlaying","LoadingText"]),formatedName(){return this.name?.replace(/\.mp3$/,"")},formatedPosition(){return W(this.position)},formatedDuration(){return W(this.duration)},author(){return w.current.author??""},album(){return w.current.album??""}},methods:{adjust(t){this.dx=t.clientX-t.layerX,this.dragging=!0;const e=t.layerX/this.$refs.progress.clientWidth;this.position=e*w.duration,this.progress=100*e+"%",document.onmousemove=this.onmousemove,document.onmouseup=this.onmouseup},onmousemove(t){if(this.dragging){var e=(t.clientX-this.dx)/this.$refs.progress.clientWidth;e<0&&(e=0),e>1&&(e=1),this.progress=100*e+"%"}},onmouseup(){this.dragging&&(this.progress=this.position/this.duration*100+"%",w.position=this.position,this.dragging=!1)}},mounted(){const t=()=>{requestAnimationFrame(t),this.dragging?this.position=parseFloat(this.progress)/100*this.duration:(this.progress=w.position/w.duration*100+"%",this.position=w.position),this.duration=w.duration,this.name=w.current.name??this.LoadingText;const e=document.getElementsByTagName("h2")[0];this.ScrollTitle=e.clientWidth>e.parentNode.clientWidth};t()}};const S=(0,x.Z)(G,[["render",F]]);var z=S,X={components:{Disk:_,Control:A,ProgressBar:z}};const Z=(0,x.Z)(X,[["render",g]]);var H=Z,q={components:{Player:H}};const Y=(0,x.Z)(q,[["render",a]]);var U=Y,K={components:{Home:U}};const J=(0,x.Z)(K,[["render",o]]);var Q=J;const V=(0,m.MT)({state:{isPlaying:!1,imgurl:""},getters:{},mutations:{togglePlay(t,e){t.isPlaying=void 0!==e?e:!t.isPlaying},changeCover(t){if(!w.current.img)return;const e=new Image;e.src=w.current.img,e.onload=()=>t.imgurl=e.src}},actions:{}});(0,s.ri)(Q).use(V).mount("#app")},1466:function(t,e,n){t.exports=n.p+"img/cover1.7645a6f5.jpg"}},e={};function n(s){var i=e[s];if(void 0!==i)return i.exports;var o=e[s]={exports:{}};return t[s](o,o.exports,n),o.exports}n.m=t,function(){var t=[];n.O=function(e,s,i,o){if(!s){var r=1/0;for(c=0;c<t.length;c++){s=t[c][0],i=t[c][1],o=t[c][2];for(var a=!0,l=0;l<s.length;l++)(!1&o||r>=o)&&Object.keys(n.O).every((function(t){return n.O[t](s[l])}))?s.splice(l--,1):(a=!1,o<r&&(r=o));if(a){t.splice(c--,1);var u=i();void 0!==u&&(e=u)}}return e}o=o||0;for(var c=t.length;c>0&&t[c-1][2]>o;c--)t[c]=t[c-1];t[c]=[s,i,o]}}(),function(){n.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return n.d(e,{a:e}),e}}(),function(){n.d=function(t,e){for(var s in e)n.o(e,s)&&!n.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:e[s]})}}(),function(){n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}()}(),function(){n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)}}(),function(){n.p="/"}(),function(){var t={143:0};n.O.j=function(e){return 0===t[e]};var e=function(e,s){var i,o,r=s[0],a=s[1],l=s[2],u=0;if(r.some((function(e){return 0!==t[e]}))){for(i in a)n.o(a,i)&&(n.m[i]=a[i]);if(l)var c=l(n)}for(e&&e(s);u<r.length;u++)o=r[u],n.o(t,o)&&t[o]&&t[o][0](),t[o]=0;return n.O(c)},s=self["webpackChunktest_music"]=self["webpackChunktest_music"]||[];s.forEach(e.bind(null,0)),s.push=e.bind(null,s.push.bind(s))}();var s=n.O(void 0,[998],(function(){return n(2616)}));s=n.O(s)})();
//# sourceMappingURL=app.a996a8bb.js.map